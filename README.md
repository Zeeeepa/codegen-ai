# CodeGen AI Project Orchestrator

## Overview

The CodeGen AI Project Orchestrator is a sophisticated, web-based command center for managing and automating the entire lifecycle of your GitHub projects. It provides a persistent dashboard to add your repositories, trigger advanced AI agent runs, configure project-specific rules and secrets, and orchestrate a powerful, automated pull request validation and deployment workflow.

This UI acts as the frontend for a suite of conceptual backend services, including AI-driven code generation, sandboxed deployments, and automated E2E testing, making it a central hub for modern, AI-assisted software development.

---

## Core Features

- **Persistent Project Dashboard**: Add your GitHub projects to a card-based dashboard that saves your configuration.
- **Deep GitHub Integration**: Fetches your repositories and branches. Simulates setting webhooks to receive real-time pull request notifications.
- **AI Agent Runs**:
    - Initiate code generation tasks by providing a high-level **Target** or goal.
    - The project card displays a live log of the agent's progress.
- **Interactive Agent Workflow**:
    - **Plan & Execute**: If the agent proposes a plan, you can review, modify, or confirm it.
    - **Continue Conversation**: Engage in a continuous dialogue with the agent to refine tasks.
    - **Automated PR Creation**: The agent can autonomously create pull requests with the generated code changes.
- **Automated PR Validation & CI/CD**:
    - A PR notification on the project card triggers a validation flow.
    - The flow uses a sandboxed environment (**Grainchain**) to deploy and test the PR.
    - An AI-powered E2E testing agent (**Web-Eval-Agent**) validates functionality.
    - The system creates a feedback loop, prompting the agent to fix issues automatically if validation fails.
- **Rich Per-Project Configuration**:
    - **Repository Rules**: Define specific instructions and constraints for the AI agent.
    - **Planning Statement**: Customize the master prompt sent to the agent for consistent behavior.
    - **Setup Commands**: Specify shell commands for setting up the project in a sandbox, with branch selection and a test-run feature.
    - **Secrets Management**: Securely add, manage, and delete environment variables for your project.
- **Markdown File Management**:
    - **README.md Viewer**: View and edit README.md files directly from project cards with syntax highlighting.
    - **PLAN.md Viewer**: View and edit PLAN.md files for project planning and documentation.
    - **File Creation**: Create missing markdown files with a single click using the plus icon.
    - **Visual Indicators**: Icons show whether files exist (document icon) or need to be created (plus icon).
    - **GitHub Integration**: Direct integration with GitHub API for seamless file operations.
- **Powerful Automation Toggles**:
    - `[ ] Auto-confirm Proposed Plan`: Automatically approve plans generated by the agent.
    - `[ ] Auto-merge Validated PR`: Automatically merge pull requests that pass the entire validation flow.

---

## Technology Stack & Services

This UI is the frontend for a powerful conceptual backend architecture.

### Frontend
- **React 18+** with **TypeScript**
- **Tailwind CSS** for utility-first styling.
- **No Router**: A clean, single-page application design.

### Backend Services & Tools (Conceptual)

1.  **GitHub Client**
    - **Responsibility**: Manages all interactions with the GitHub API.
    - **Functions**: Fetches repos/branches, sets webhooks.
    - **Mocked in**: `services/api.ts`

2.  **Cloudflare Worker (`webhook-gateway`)**
    - **Responsibility**: Provides a public endpoint to receive GitHub webhooks.
    - **URL**: `https://webhook-gateway.pixeliumperfecto.workers.dev`
    - **Functions**: Triggers the backend validation workflow upon receiving PR events.

3.  **Codegen SDK (Core Agent)**
    - **Responsibility**: The core AI engine for code generation and task execution.
    - **API**: `https://docs.codegen.com/api-reference/agents/create-agent-run`
    - **Functions**: Generates plans, writes code, and creates pull requests based on user prompts and project context.

4.  **Grainchain (Sandboxing & Deployment)**
    - **GitHub**: `github.com/zeeeepa/grainchain`
    - **Responsibility**: Creates secure, isolated sandbox environments for validating PRs.
    - **Functions**: Creates instance snapshots, clones PR code, and runs user-defined deployment commands.

5.  **Graph-Sitter (Code Analysis)**
    - **GitHub**: `github.com/zeeeepa/graph-sitter`
    - **Responsibility**: Performs static analysis on the codebase to provide rich context to the AI agent.

6.  **Web-Eval-Agent (UI & E2E Testing)**
    - **GitHub**: `github.com/zeeeepa/web-eval-agent`
    - **Responsibility**: Automates browser-based testing using Gemini to validate application functionality.
    - **Functions**: Runs E2E tests on the sandboxed deployment and reports success or failure.

---

## Workflow & Usage Guide

1.  **Add a Project**:
    - Use the dropdown in the header to find and select your GitHub repository.
    - Click **"Add Project"**. This pins it to your dashboard and simulates setting a webhook on the repo.

2.  **Configure the Project**:
    - Click the **gear icon** on the project card to open the settings modal.
    - **Repository Rules**: Add guidelines for the AI. The card border will turn purple to indicate rules are active.
    - **Planning Statement**: Customize the master prompt for the agent.
    - **Setup Commands**: Provide the shell commands to install and run your project (e.g., `npm install && npm run dev`). You can test them on a specific branch.
    - **Secrets**: Add required environment variables like `CODEGEN_API_TOKEN` or `GEMINI_API_KEY`.
    - **Markdown Files**: Use the document icons on the project card to view/edit README.md and PLAN.md files:
        - **Blue document icon**: View/edit README.md
        - **Green document icon**: View/edit PLAN.md
        - **Plus icons**: Create missing markdown files

3.  **Run the AI Agent**:
    - Click the **"Run Agent"** button.
    - Enter your goal in the **"Target"** text area (e.g., "Add a dark mode toggle to the navbar").
    - Click **"Confirm"**. The agent run begins, and logs appear on the card.

4.  **Monitor & Interact**:
    - The project card displays the agent's current status (e.g., Running, Plan Proposed).
    - If the agent proposes a **Plan**, you can **"Confirm"** it to proceed. If `Auto-confirm` is enabled, this happens automatically.
    - If the agent gives a regular response, you can **"Continue"** the conversation with more instructions.
    - If the agent creates a **Pull Request**, a notification will appear on the card with the PR count.

5.  **Validate the Pull Request**:
    - Click the **PR notification icon** on the card to trigger the validation flow.
    - **Status**: The card status changes to "Validating PR".
    - **Process**: The system simulates cloning the PR, running setup commands in a **Grainchain** sandbox, and deploying the app.
    - **Testing**: The **Web-Eval-Agent** tests all functionalities.
    - **Feedback Loop**: If tests fail, the agent is automatically re-prompted with the error context to fix the PR. The cycle repeats until the PR is validated.

6.  **Merge the PR**:
    - Once validation is successful, you can manually **"Merge to main"** or **"Open in GitHub"**.
    - If **`[x] Auto-merge validated PR`** is enabled, the merge happens automatically.
